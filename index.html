<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jogo Educativo</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4CAF50">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Jogo L√≠nguas">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            user-select: none;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            text-align: center;
        }

        .header h1 {
            color: #4a5568;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .stats {
            display: flex;
            justify-content: space-around;
            margin-top: 15px;
        }

        .stat {
            text-align: center;
        }

        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            font-size: 0.9em;
            color: #666;
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .nav-btn {
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 25px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 120px;
        }

        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .nav-btn.active {
            background: linear-gradient(45deg, #48bb78, #38a169);
        }

        .game-area {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            flex: 1;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .question-display {
            text-align: center;
            margin-bottom: 30px;
        }

        .question-text {
            font-size: 1.5em;
            color: #4a5568;
            margin-bottom: 20px;
            line-height: 1.4;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #48bb78, #38a169);
            transition: width 0.3s ease;
        }

        .word-bank {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-bottom: 30px;
            min-height: 80px;
            padding: 20px;
            background: #f7fafc;
            border-radius: 15px;
            border: 2px dashed #cbd5e0;
        }

        .word-chip {
            padding: 12px 20px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            border: none;
            font-size: 1em;
            min-width: 45px;
            text-align: center;
        }

        .word-chip.letter {
            padding: 15px;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            font-weight: bold;
        }

        .word-chip:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .word-chip.selected {
            background: linear-gradient(45deg, #48bb78, #38a169);
            transform: scale(1.1);
        }

        .answer-area {
            min-height: 100px;
            padding: 20px;
            background: #f7fafc;
            border-radius: 15px;
            border: 2px solid #e2e8f0;
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
            justify-content: center;
        }

        .answer-area.correct {
            border-color: #48bb78;
            background: #f0fff4;
        }

        .answer-area.incorrect {
            border-color: #f56565;
            background: #fff5f5;
        }

        .game-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .game-btn {
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 120px;
        }

        .btn-check {
            background: linear-gradient(45deg, #48bb78, #38a169);
            color: white;
        }

        .btn-clear {
            background: linear-gradient(45deg, #f56565, #e53e3e);
            color: white;
        }

        .btn-next {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .game-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .game-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .admin-panel {
            display: none;
        }

        .admin-panel.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #4a5568;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .questions-list {
            max-height: 300px;
            overflow-y: auto;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 15px;
            background: #f7fafc;
        }

        .question-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin-bottom: 10px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .question-item:last-child {
            margin-bottom: 0;
        }

        .question-content {
            flex: 1;
        }

        .question-actions {
            display: flex;
            gap: 10px;
        }

        .btn-small {
            padding: 5px 12px;
            border: none;
            border-radius: 15px;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-edit {
            background: #667eea;
            color: white;
        }

        .btn-delete {
            background: #f56565;
            color: white;
        }

        .btn-small:hover {
            transform: scale(1.05);
        }

        .file-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .file-input {
            display: none;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 1.5em;
            color: #4a5568;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: #666;
        }

        .feedback {
            text-align: center;
            padding: 20px;
            margin: 20px 0;
            border-radius: 15px;
            font-size: 1.2em;
            font-weight: bold;
        }

        .feedback.correct {
            background: #f0fff4;
            color: #38a169;
            border: 2px solid #48bb78;
        }

        .feedback.incorrect {
            background: #fff5f5;
            color: #e53e3e;
            border: 2px solid #f56565;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header h1 {
                font-size: 2em;
            }

            .nav-buttons {
                flex-direction: column;
            }

            .nav-btn {
                min-width: auto;
            }

            .game-area {
                padding: 20px;
            }

            .question-text {
                font-size: 1.2em;
            }

            .word-chip {
                padding: 10px 15px;
                font-size: 0.9em;
            }

            .game-buttons {
                flex-direction: column;
            }

            .game-btn {
                min-width: auto;
            }

            .stats {
                flex-direction: row;
                gap: 10px;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>üéØ Jogo Educativo</h1>
            <div class="stats">
                <div class="stat">
                    <div class="stat-value" id="totalQuestions">0</div>
                    <div class="stat-label">Perguntas</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="correctAnswers">0</div>
                    <div class="stat-label">Acertos</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="accuracy">0%</div>
                    <div class="stat-label">Precis√£o</div>
                </div>
            </div>
        </div>

        <div class="nav-buttons">
            <button class="nav-btn active" onclick="showGame()">üéÆ Jogar</button>
            <button class="nav-btn" onclick="showAdmin()">‚öôÔ∏è Gerenciar</button>
        </div>

        <div class="game-area">
            <!-- √Årea do Jogo -->
            <div id="gamePanel">
                <div class="question-display">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressBar"></div>
                    </div>
                    <div class="question-text" id="questionText">Clique em "Iniciar Jogo" para come√ßar!</div>
                </div>

                <div class="word-bank" id="wordBank"></div>

                <div class="answer-area" id="answerArea"></div>

                <div class="game-buttons">
                    <button class="game-btn btn-check" id="checkBtn" onclick="checkAnswer()" disabled>‚úì
                        Verificar</button>
                    <button class="game-btn btn-clear" onclick="clearAnswer()">üóëÔ∏è Limpar</button>
                    <button class="game-btn btn-next" onclick="startGame()">‚ñ∂Ô∏è Iniciar Jogo</button>
                </div>

                <div id="feedback" class="feedback" style="display: none;"></div>
            </div>

            <!-- Painel Administrativo -->
            <div id="adminPanel" class="admin-panel">
                <div class="file-buttons">
                    <button class="nav-btn" onclick="document.getElementById('importFile').click()">üìÅ Importar</button>
                    <button class="nav-btn" onclick="exportQuestions()">üíæ Exportar</button>
                    <button class="nav-btn" onclick="clearAllData()">üóëÔ∏è Limpar Tudo</button>
                </div>

                <input type="file" id="importFile" class="file-input" accept=".json" onchange="importQuestions(event)">

                <div class="form-group">
                    <!-- <label for="questionInput">Pergunta:</label> -->
                    <label for="questionLanguage">Pergunta, Idioma da Pergunta:</label>
                    <select id="questionLanguage">
                        <option value="portugu√™s">Portugu√™s</option>
                        <option value="ingl√™s">Ingl√™s</option>
                        <option value="espanhol">Espanhol</option>
                        <option value="franc√™s">Franc√™s</option>
                        <option value="italiano">Italiano</option>
                    </select>
                    <input type="text" id="questionInput" placeholder="Digite a pergunta aqui...">
                </div>

                <div class="form-group">
                    <!-- <label for="answerInput">Resposta:</label> -->
                    <label for="answerLanguage">Resposta, Idioma da Resposta:</label>
                    <select id="answerLanguage">
                        <option value="portugu√™s">Portugu√™s</option>
                        <option value="ingl√™s">Ingl√™s</option>
                        <option value="espanhol">Espanhol</option>
                        <option value="franc√™s">Franc√™s</option>
                        <option value="italiano">Italiano</option>
                    </select>
                    <input type="text" id="answerInput" placeholder="Digite a resposta aqui...">



                </div>

                <div class="form-group">
                    <label for="gameType">Tipo de Jogo:</label>
                    <select id="gameType" onchange="toggleGameType()">
                        <option value="words">Palavras</option>
                        <option value="letters">Letras</option>
                    </select>
                </div>

                <div class="form-group" id="wordsGroup">
                    <label for="wordsInput">Palavras para escolha (separadas por v√≠rgula):</label>
                    <textarea id="wordsInput" rows="3" placeholder="palavra1, palavra2, palavra3, ..."></textarea>
                </div>

                <div class="form-group" id="lettersGroup" style="display: none;">
                    <label for="lettersInput">Letras extras (opcional - separadas por v√≠rgula):</label>
                    <textarea id="lettersInput" rows="2" placeholder="a, b, c, x, y, z, ..."></textarea>
                    <small style="color: #666; margin-top: 5px; display: block;">
                        As letras da resposta s√£o inclu√≠das automaticamente. Adicione letras extras para aumentar a
                        dificuldade.
                    </small>
                </div>

                <div class="game-buttons">
                    <button class="game-btn btn-check" onclick="addQuestion()">‚ûï Adicionar</button>
                    <button class="game-btn btn-clear" onclick="clearForm()">üßπ Limpar Campos</button>
                </div>

                <div class="form-group">
                    <label>Perguntas Cadastradas:</label>
                    <div class="questions-list" id="questionsList"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Edi√ß√£o -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Editar Pergunta</h2>
                <button class="close-btn" onclick="closeEditModal()">&times;</button>
            </div>

            <div class="form-group">
                <!-- <label for="editQuestion">Pergunta:</label> -->
                <label for="editQuestionLanguage">Pergunta, Idioma da Pergunta:</label>
                <select id="editQuestionLanguage">
                    <option value="portugu√™s">Portugu√™s</option>
                    <option value="ingl√™s">Ingl√™s</option>
                    <option value="espanhol">Espanhol</option>
                    <option value="franc√™s">Franc√™s</option>
                    <option value="italiano">Italiano</option>
                </select>
                <input type="text" id="editQuestion">
            </div>

            <div class="form-group">
                <!-- <label for="editAnswer">Resposta:</label> -->
                <label for="editAnswerLanguage">Resposta, Idioma da Resposta:</label>
                <select id="editAnswerLanguage">
                    <option value="portugu√™s">Portugu√™s</option>
                    <option value="ingl√™s">Ingl√™s</option>
                    <option value="espanhol">Espanhol</option>
                    <option value="franc√™s">Franc√™s</option>
                    <option value="italiano">Italiano</option>
                </select>
                <input type="text" id="editAnswer">
            </div>

            <div class="form-group">
                <label for="editGameType">Tipo de Jogo:</label>
                <select id="editGameType" onchange="toggleEditGameType()">
                    <option value="words">Palavras</option>
                    <option value="letters">Letras</option>
                </select>
            </div>

            <div class="form-group" id="editWordsGroup">
                <label for="editWords">Palavras (separadas por v√≠rgula):</label>
                <textarea id="editWords" rows="3"></textarea>
            </div>

            <div class="form-group" id="editLettersGroup" style="display: none;">
                <label for="editLetters">Letras extras (separadas por v√≠rgula):</label>
                <textarea id="editLetters" rows="2"></textarea>
            </div>

            <div class="game-buttons">
                <button class="game-btn btn-check" onclick="saveEdit()">üíæ Salvar</button>
                <button class="game-btn btn-clear" onclick="closeEditModal()">‚ùå Cancelar</button>
            </div>
        </div>
    </div>

    <script>
        // IndexedDB Configuration
        let db;
        const dbName = 'DuolingoGameDB';
        const dbVersion = 1;

        // Game State
        let questions = [];
        let currentQuestion = null;
        let currentQuestionIndex = 0;
        let selectedWords = [];
        let gameStats = {
            totalQuestions: 0,
            correctAnswers: 0,
            totalAnswered: 0
        };
        let editingIndex = -1;
        let remainingQuestions = []; //1 Array para controlar perguntas n√£o respondidas

        // Initialize IndexedDB
        function initDB() {
            const request = indexedDB.open(dbName, dbVersion);

            request.onerror = function (event) {
                console.error('Database error:', event.target.error);
            };

            request.onsuccess = function (event) {
                db = event.target.result;
                loadQuestions();
                loadStats();
            };

            request.onupgradeneeded = function (event) {
                db = event.target.result;

                // Create questions store
                if (!db.objectStoreNames.contains('questions')) {
                    const questionsStore = db.createObjectStore('questions', { keyPath: 'id', autoIncrement: true });
                    questionsStore.createIndex('question', 'question', { unique: false });
                }

                // Create stats store
                if (!db.objectStoreNames.contains('stats')) {
                    const statsStore = db.createObjectStore('stats', { keyPath: 'id' });
                }
            };
        }

        // Database Operations
        function saveQuestion(question) {
            const transaction = db.transaction(['questions'], 'readwrite');
            const store = transaction.objectStore('questions');
            store.add(question);

            transaction.oncomplete = function () {
                loadQuestions();
            };
        }

        function updateQuestion(id, questionData) {
            const transaction = db.transaction(['questions'], 'readwrite');
            const store = transaction.objectStore('questions');

            const getRequest = store.get(id);
            getRequest.onsuccess = function () {
                const data = getRequest.result;
                Object.assign(data, questionData);

                const putRequest = store.put(data);
                putRequest.onsuccess = function () {
                    loadQuestions();
                };
            };
        }

        function deleteQuestion(id) {
            const transaction = db.transaction(['questions'], 'readwrite');
            const store = transaction.objectStore('questions');
            store.delete(id);

            transaction.oncomplete = function () {
                loadQuestions();
            };
        }

        function loadQuestions() {
            const transaction = db.transaction(['questions'], 'readonly');
            const store = transaction.objectStore('questions');
            const request = store.getAll();

            request.onsuccess = function () {
                questions = request.result;
                updateQuestionsList();
                updateStats();
            };
        }

        function saveStats() {
            const transaction = db.transaction(['stats'], 'readwrite');
            const store = transaction.objectStore('stats');
            store.put({ id: 'gameStats', ...gameStats });
        }

        function loadStats() {
            const transaction = db.transaction(['stats'], 'readonly');
            const store = transaction.objectStore('stats');
            const request = store.get('gameStats');

            request.onsuccess = function () {
                if (request.result) {
                    gameStats = { ...gameStats, ...request.result };
                }
                updateStatsDisplay();
            };
        }
        // Speech Functions
        function speakText(text, language = 'pt-BR') {
            if ('speechSynthesis' in window) {
                // Para mobile, precisa ser ativado por intera√ß√£o do usu√°rio
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = language;
                utterance.rate = 0.8;
                utterance.volume = 1.0;

                // Garantir que o speechSynthesis est√° pronto
                if (speechSynthesis.speaking) {
                    speechSynthesis.cancel();
                }

                speechSynthesis.speak(utterance);
            }
        }//1

        function getLanguageCode(language) {
            const languages = {
                'portugu√™s': 'pt-BR',
                'ingl√™s': 'en-US',
                'espanhol': 'es-ES',
                'franc√™s': 'fr-FR',
                'italiano': 'it-IT'
            };
            return languages[language] || 'pt-BR';
        }
        // Game Logic
function startGame() {
    if (questions.length === 0) {
        alert('Adicione algumas perguntas primeiro!');
        showAdmin();
        return;
    }

    // Se n√£o h√° perguntas restantes, reiniciar com todas as perguntas
    if (remainingQuestions.length === 0) {
        remainingQuestions = [...questions.map((q, index) => index)]; // Cria array com √≠ndices
        shuffleArray(remainingQuestions); // Embaralha as perguntas
    }

    // Pega a pr√≥xima pergunta da lista embaralhada
    currentQuestionIndex = remainingQuestions.shift(); // Remove e retorna o primeiro item
    currentQuestion = questions[currentQuestionIndex];

    displayQuestion();
    document.getElementById('feedback').style.display = 'none';
}//2

        function displayQuestion() {
            document.getElementById('questionText').textContent = currentQuestion.question;
            // Speak the question
            if (currentQuestion.questionLanguage) {
                setTimeout(() => {
                    speakText(currentQuestion.question, getLanguageCode(currentQuestion.questionLanguage));
                }, 500);//2
            }

            let allItems = [];

            if (currentQuestion.type === 'letters') {
                // Generate letters for the answer
                const answerLetters = currentQuestion.answer.toLowerCase()
                    .split('')
                    .filter(char => char.match(/[a-z√°√†√¢√£√©√™√≠√≥√¥√µ√∫√ß√±√º]/i));

                // Add extra letters if provided
                const extraLetters = currentQuestion.extraLetters || [];

                // Combine and shuffle
                allItems = [...answerLetters, ...extraLetters];

                // Add some random letters if we don't have enough
                const alphabet = 'abcdefghijklmnopqrstuvwxyz'.split('');
                while (allItems.length < Math.max(8, answerLetters.length + 3)) {
                    const randomLetter = alphabet[Math.floor(Math.random() * alphabet.length)];
                    if (!allItems.includes(randomLetter)) {
                        allItems.push(randomLetter);
                    }
                }
            } else {
                // Use words as before
                allItems = [...currentQuestion.words];
            }

            shuffleArray(allItems);

            // Display word/letter bank
            const wordBank = document.getElementById('wordBank');
            wordBank.innerHTML = '';

            allItems.forEach(item => {
                const itemChip = document.createElement('button');
                itemChip.className = currentQuestion.type === 'letters' ? 'word-chip letter' : 'word-chip';
                itemChip.textContent = item.toUpperCase();
                itemChip.onclick = () => selectItem(item, itemChip);
                wordBank.appendChild(itemChip);
            });

            // Clear answer area
            clearAnswer();

            // Update progress
            updateProgress();
        }

        function selectItem(item, chipElement) {
            if (chipElement.classList.contains('selected')) {
                return;
            }

            selectedWords.push(item);
            chipElement.classList.add('selected');

            // Add to answer area
            const answerArea = document.getElementById('answerArea');
            const answerChip = document.createElement('button');
            answerChip.className = currentQuestion.type === 'letters' ? 'word-chip letter' : 'word-chip';
            answerChip.textContent = currentQuestion.type === 'letters' ? item.toUpperCase() : item;
            answerChip.onclick = () => removeItem(item, answerChip, chipElement);
            answerArea.appendChild(answerChip);

            // Enable check button if we have items
            document.getElementById('checkBtn').disabled = selectedWords.length === 0;
        }

        function removeItem(item, answerChip, originalChip) {
            const index = selectedWords.indexOf(item);
            if (index > -1) {
                selectedWords.splice(index, 1);
            }

            answerChip.remove();
            originalChip.classList.remove('selected');

            document.getElementById('checkBtn').disabled = selectedWords.length === 0;
        }

        function clearAnswer() {
            selectedWords = [];
            document.getElementById('answerArea').innerHTML = '';
            document.getElementById('answerArea').className = 'answer-area';

            // Reset word chips
            document.querySelectorAll('.word-chip.selected').forEach(chip => {
                chip.classList.remove('selected');
            });

            document.getElementById('checkBtn').disabled = true;
        }

        function checkAnswer() {
            let userAnswer, correctAnswer;

            if (currentQuestion.type === 'letters') {
                // For letters, join without spaces and normalize
                userAnswer = selectedWords.join('').toLowerCase().trim();
                correctAnswer = currentQuestion.answer.toLowerCase().replace(/\s+/g, '').trim();
            } else {
                // For words, join with spaces
                userAnswer = selectedWords.join(' ').toLowerCase().trim();
                correctAnswer = currentQuestion.answer.toLowerCase().trim();
            }

            const feedbackEl = document.getElementById('feedback');
            const answerArea = document.getElementById('answerArea');

            gameStats.totalAnswered++;

            if (userAnswer === correctAnswer) {
                feedbackEl.textContent = 'üéâ Correto! Muito bem!';
                feedbackEl.className = 'feedback correct';
                answerArea.className = 'answer-area correct';
                gameStats.correctAnswers++;
                vibrate([50, 100, 50]); // Success vibration pattern
                // Speak the correct answer
                if (currentQuestion.answerLanguage) {
                    setTimeout(() => {
                        speakText(currentQuestion.answer, getLanguageCode(currentQuestion.answerLanguage));
                    }, 1000);
                }
            } else {
                feedbackEl.textContent = `‚ùå Incorreto! A resposta era: "${currentQuestion.answer}"`;
                feedbackEl.className = 'feedback incorrect';
                answerArea.className = 'answer-area incorrect';
                vibrate(200); // Error vibration

                // Falar a resposta correta no idioma certo
                if (currentQuestion.answerLanguage) {
                    setTimeout(() => {
                        speakText(currentQuestion.answer, getLanguageCode(currentQuestion.answerLanguage));
                    }, 1000);
                }
            }

            feedbackEl.style.display = 'block';
            document.getElementById('checkBtn').disabled = true;

            // Save stats and update display
            saveStats();
            updateStatsDisplay();

            // Auto next question after 3 seconds, ou finalizar se n√£o houver mais
            setTimeout(() => {
                nextQuestion();
            }, 3000);
        }

        function nextQuestion() {//fun√ßao para pular para proxima pergunta
    // Verificar se ainda h√° perguntas restantes
    if (remainingQuestions.length === 0) {
        // Finalizar jogo - todas as perguntas foram respondidas
        document.getElementById('questionText').textContent = 'üéâ Parab√©ns! Voc√™ completou todas as perguntas!';
        document.getElementById('wordBank').innerHTML = '';
        document.getElementById('answerArea').innerHTML = '';
        document.getElementById('feedback').style.display = 'none';
        document.getElementById('checkBtn').disabled = true;
        
        // Mostrar op√ß√£o para jogar novamente
        setTimeout(() => {
            if (confirm('Quer jogar novamente?')) {
                startGame();
            }
        }, 2000);
        return;
    }

    // Continuar para pr√≥xima pergunta
    startGame();
}//3

        // Admin Functions
        function toggleGameType() {
            const gameType = document.getElementById('gameType').value;
            const wordsGroup = document.getElementById('wordsGroup');
            const lettersGroup = document.getElementById('lettersGroup');

            if (gameType === 'letters') {
                wordsGroup.style.display = 'none';
                lettersGroup.style.display = 'block';
            } else {
                wordsGroup.style.display = 'block';
                lettersGroup.style.display = 'none';
            }
        }

        function toggleEditGameType() {
            const gameType = document.getElementById('editGameType').value;
            const wordsGroup = document.getElementById('editWordsGroup');
            const lettersGroup = document.getElementById('editLettersGroup');

            if (gameType === 'letters') {
                wordsGroup.style.display = 'none';
                lettersGroup.style.display = 'block';
            } else {
                wordsGroup.style.display = 'block';
                lettersGroup.style.display = 'none';
            }
        }

        function addQuestion() {
            const question = document.getElementById('questionInput').value.trim();
            const answer = document.getElementById('answerInput').value.trim();
            const gameType = document.getElementById('gameType').value;

            if (!question || !answer) {
                alert('Por favor, preencha a pergunta e a resposta!');
                return;
            }

            let questionObj = {
                question: question,
                answer: answer,
                type: gameType,
                questionLanguage: document.getElementById('questionLanguage').value,
                answerLanguage: document.getElementById('answerLanguage').value,
            };

            if (gameType === 'letters') {
                const lettersInput = document.getElementById('lettersInput').value.trim();
                const extraLetters = lettersInput ?
                    lettersInput.split(',').map(letter => letter.trim().toLowerCase()).filter(letter => letter) : [];

                questionObj.extraLetters = extraLetters;
            } else {
                const wordsInput = document.getElementById('wordsInput').value.trim();

                if (!wordsInput) {
                    alert('Por favor, adicione palavras para escolha!');
                    return;
                }

                const words = wordsInput.split(',').map(word => word.trim()).filter(word => word);

                if (words.length < 2) {
                    alert('Adicione pelo menos 2 palavras para escolha!');
                    return;
                }

                // Add answer words to word bank if not present
                const answerWords = answer.split(' ').filter(word => word.trim());
                answerWords.forEach(word => {
                    if (!words.includes(word)) {
                        words.push(word);
                    }
                });

                questionObj.words = words;
            }

            saveQuestion(questionObj);
            clearForm();
        }

        function clearForm() {
            document.getElementById('questionInput').value = '';
            document.getElementById('answerInput').value = '';
            document.getElementById('wordsInput').value = '';
            document.getElementById('lettersInput').value = '';
            document.getElementById('gameType').value = 'words';
            document.getElementById('questionLanguage').value = 'portugu√™s';
            document.getElementById('answerLanguage').value = 'ingl√™s';
            toggleGameType();
        }

        function updateQuestionsList() {
            const list = document.getElementById('questionsList');
            list.innerHTML = '';

            questions.forEach((q, index) => {
                const item = document.createElement('div');
                item.className = 'question-item';

                const typeIcon = q.type === 'letters' ? 'üî§' : 'üìù';
                const extraInfo = q.type === 'letters' ?
                    (q.extraLetters && q.extraLetters.length > 0 ?
                        `<small><strong>Letras extras:</strong> ${q.extraLetters.join(', ')}</small>` :
                        '<small><strong>Tipo:</strong> Apenas letras da resposta</small>') :
                    `<small><strong>Palavras:</strong> ${q.words.join(', ')}</small>`;

                item.innerHTML = `
                    <div class="question-content">
                        ${typeIcon} <strong>P:</strong> ${q.question}<br>
                        <strong>R:</strong> ${q.answer}<br>
                        ${extraInfo}
                    </div>
                    <div class="question-actions">
                        <button class="btn-small btn-edit" onclick="editQuestion(${q.id})">‚úèÔ∏è</button>
                        <button class="btn-small btn-delete" onclick="deleteQuestionConfirm(${q.id})">üóëÔ∏è</button>
                    </div>
                `;

                list.appendChild(item);
            });
        }

        function editQuestion(id) {
            const question = questions.find(q => q.id === id);
            if (!question) return;

            editingIndex = id;
            document.getElementById('editQuestion').value = question.question;
            document.getElementById('editAnswer').value = question.answer;

            // Set game type
            document.getElementById('editGameType').value = question.type || 'words';
            toggleEditGameType();

            if (question.type === 'letters') {
                document.getElementById('editLetters').value = (question.extraLetters || []).join(', ');
            } else {
                document.getElementById('editWords').value = (question.words || []).join(', ');
            }

            document.getElementById('editModal').classList.add('active');
            document.getElementById('editQuestionLanguage').value = question.questionLanguage || 'portugu√™s';
            document.getElementById('editAnswerLanguage').value = question.answerLanguage || 'ingl√™s';
        }

        function saveEdit() {
            const question = document.getElementById('editQuestion').value.trim();
            const answer = document.getElementById('editAnswer').value.trim();
            const gameType = document.getElementById('editGameType').value;

            if (!question || !answer) {
                alert('Por favor, preencha a pergunta e a resposta!');
                return;
            }

            let questionData = {
                question: question,
                answer: answer,
                type: gameType,
                questionLanguage: document.getElementById('editQuestionLanguage').value,
                answerLanguage: document.getElementById('editAnswerLanguage').value,
            };

            if (gameType === 'letters') {
                const lettersInput = document.getElementById('editLetters').value.trim();
                const extraLetters = lettersInput ?
                    lettersInput.split(',').map(letter => letter.trim().toLowerCase()).filter(letter => letter) : [];

                questionData.extraLetters = extraLetters;
            } else {
                const wordsInput = document.getElementById('editWords').value.trim();

                if (!wordsInput) {
                    alert('Por favor, adicione palavras para escolha!');
                    return;
                }

                const words = wordsInput.split(',').map(word => word.trim()).filter(word => word);

                if (words.length < 2) {
                    alert('Adicione pelo menos 2 palavras para escolha!');
                    return;
                }

                // Add answer words to word bank if not present
                const answerWords = answer.split(' ').filter(word => word.trim());
                answerWords.forEach(word => {
                    if (!words.includes(word)) {
                        words.push(word);
                    }
                });

                questionData.words = words;
            }

            updateQuestion(editingIndex, questionData);
            closeEditModal();
        }

        function closeEditModal() {
            document.getElementById('editModal').classList.remove('active');
            editingIndex = -1;
        }

        function deleteQuestionConfirm(id) {
            if (confirm('Tem certeza que deseja excluir esta pergunta?')) {
                deleteQuestion(id);
            }
        }

        function clearAllData() {
            if (confirm('Tem certeza que deseja excluir TODAS as perguntas e estat√≠sticas? Esta a√ß√£o n√£o pode ser desfeita!')) {
                const transaction = db.transaction(['questions', 'stats'], 'readwrite');

                transaction.objectStore('questions').clear();
                transaction.objectStore('stats').clear();

                transaction.oncomplete = function () {
                    questions = [];
                    gameStats = {
                        totalQuestions: 0,
                        correctAnswers: 0,
                        totalAnswered: 0
                    };
                    updateQuestionsList();
                    updateStatsDisplay();
                    alert('Todos os dados foram exclu√≠dos!');
                };
            }
        }

        // Import/Export Functions
        function exportQuestions() {
            if (questions.length === 0) {
                alert('N√£o h√° perguntas para exportar!');
                return;
            }

            const data = {
                questions: questions,
                stats: gameStats,
                exportDate: new Date().toISOString()
            };

            const jsonStr = JSON.stringify(data, null, 2);
            const blob = new Blob([jsonStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);

            const a = document.createElement('a');
            a.href = url;
            a.download = `jogo_educativo_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function importQuestions(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function (e) {
                try {
                    const data = JSON.parse(e.target.result);

                    if (!data.questions || !Array.isArray(data.questions)) {
                        alert('Arquivo inv√°lido! Certifique-se de que √© um arquivo de exporta√ß√£o v√°lido.');
                        return;
                    }

                    if (confirm(`Importar ${data.questions.length} perguntas? Isso adicionar√° √†s perguntas existentes.`)) {
                        // Import questions
                        const transaction = db.transaction(['questions'], 'readwrite');
                        const store = transaction.objectStore('questions');

                        data.questions.forEach(question => {
                            // Remove id to avoid conflicts
                            const { id, ...questionData } = question;
                            store.add(questionData);
                        });

                        transaction.oncomplete = function () {
                            loadQuestions();
                            alert('Perguntas importadas com sucesso!');
                        };
                    }
                } catch (error) {
                    alert('Erro ao ler o arquivo! Certifique-se de que √© um arquivo JSON v√°lido.');
                    console.error('Import error:', error);
                }
            };
            reader.readAsText(file);

            // Clear the input
            event.target.value = '';
        }

        // Navigation Functions
        function showGame() {
            document.getElementById('gamePanel').style.display = 'block';
            document.getElementById('adminPanel').classList.remove('active');

            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.nav-btn')[0].classList.add('active');
        }

        function showAdmin() {
            document.getElementById('gamePanel').style.display = 'none';
            document.getElementById('adminPanel').classList.add('active');

            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.nav-btn')[1].classList.add('active');
        }

        // Utility Functions
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

function updateProgress() {
    if (questions.length === 0) return;
    
    const totalQuestions = questions.length;
    const questionsAnswered = totalQuestions - remainingQuestions.length;
    const progress = (questionsAnswered / totalQuestions) * 100;
    
    document.getElementById('progressBar').style.width = progress + '%';
}//4

        function updateStats() {
            gameStats.totalQuestions = questions.length;
            updateStatsDisplay();
        }

        function updateStatsDisplay() {
            document.getElementById('totalQuestions').textContent = gameStats.totalQuestions;
            document.getElementById('correctAnswers').textContent = gameStats.correctAnswers;

            const accuracy = gameStats.totalAnswered > 0 ?
                Math.round((gameStats.correctAnswers / gameStats.totalAnswered) * 100) : 0;
            document.getElementById('accuracy').textContent = accuracy + '%';
        }

        // Keyboard Support
        document.addEventListener('keydown', function (e) {
            if (e.key === 'Enter' && !document.getElementById('checkBtn').disabled) {
                checkAnswer();
            } else if (e.key === 'Escape') {
                clearAnswer();
            }
        });

        // Touch Support for Mobile
        document.addEventListener('touchstart', function (e) {
            // Prevent zoom on double tap
            if (e.touches.length > 1) {
                e.preventDefault();
            }
        });

        // Initialize App
        document.addEventListener('DOMContentLoaded', function () {
            initDB();

            // Add some sample questions if none exist
            setTimeout(() => {
                if (questions.length === 0) {
                    const sampleQuestions = [
                        {
                            question: "Como se diz 'ol√°' em ingl√™s?",
                            answer: "hello",
                            type: "words",
                            words: ["hello", "goodbye", "please", "thank", "you"]
                        },
                        {
                            question: "Complete: 'The cat is ___'",
                            answer: "sleeping",
                            type: "words",
                            words: ["sleeping", "running", "eating", "playing", "jumping"]
                        },
                        {
                            question: "Forme a palavra: 'GATO'",
                            answer: "gato",
                            type: "letters",
                            extraLetters: ["b", "c", "d", "f", "h", "j", "k", "l", "m", "n", "p", "q", "r", "s", "v", "w", "x", "y", "z"]
                        },
                        {
                            question: "Forme a palavra: 'CASA'",
                            answer: "casa",
                            type: "letters",
                            extraLetters: ["b", "d", "e", "f", "g", "h", "i", "j", "k", "l", "m", "n", "o", "p", "q", "r", "t", "u", "v", "w", "x", "y", "z"]
                        },
                        {
                            question: "Complete: 'Eu _____ estudar'",
                            answer: "gosto de",
                            type: "words",
                            words: ["gosto", "de", "n√£o", "quero", "vou"]
                        },
                        {
                            question: "Forme a palavra: 'AMOR'",
                            answer: "amor",
                            type: "letters",
                            extraLetters: ["b", "c", "d", "e", "f", "g", "h", "i", "j", "k", "l", "n", "p", "q", "s", "t", "u", "v", "w", "x", "y", "z"]
                        }
                    ];

                    const transaction = db.transaction(['questions'], 'readwrite');
                    const store = transaction.objectStore('questions');

                    sampleQuestions.forEach(question => {
                        store.add(question);
                    });

                    transaction.oncomplete = function () {
                        loadQuestions();
                    };
                }
            }, 1000);
        });

        // Service Worker Registration for PWA
if ('serviceWorker' in navigator) {
    window.addEventListener('load', function () {
        navigator.serviceWorker.register('/lingua/sw.js').then(function (registration) {
                    console.log('ServiceWorker registration successful');
                }).catch(function (err) {
                    console.log('ServiceWorker registration failed: ', err);
                });
            });
        }

        // Prevent context menu on long press (mobile)
        document.addEventListener('contextmenu', function (e) {
            e.preventDefault();
        });

        // Add haptic feedback for mobile
        function vibrate(pattern = 50) {
            if ('vibrate' in navigator) {
                navigator.vibrate(pattern);
            }
        }

        // Add vibration to button clicks
        document.addEventListener('click', function (e) {
            if (e.target.classList.contains('word-chip') || e.target.classList.contains('game-btn')) {
                vibrate(30);
            }
        });

        // Auto-save feature
        let autoSaveInterval;
        function startAutoSave() {
            autoSaveInterval = setInterval(() => {
                saveStats();
            }, 30000); // Save every 30 seconds
        }

        function stopAutoSave() {
            if (autoSaveInterval) {
                clearInterval(autoSaveInterval);
            }
        }

        // Start auto-save when page loads
        document.addEventListener('DOMContentLoaded', function () {
            startAutoSave();
        });

        // Save before page unload
        window.addEventListener('beforeunload', function () {
            saveStats();
            stopAutoSave();
        });

        // Add smooth scrolling for mobile
        document.documentElement.style.scrollBehavior = 'smooth';

        // Handle screen orientation changes
        window.addEventListener('orientationchange', function () {
            setTimeout(() => {
                window.scrollTo(0, 0);
            }, 100);
        });

        // Add loading indicator
        function showLoading() {
            document.body.style.cursor = 'wait';
        }

        function hideLoading() {
            document.body.style.cursor = 'default';
        }

        // Enhanced error handling
        window.addEventListener('error', function (e) {
            console.error('Application error:', e.error);
            alert('Ocorreu um erro inesperado. Tente recarregar a p√°gina.');
        });

        // Database error handling
        window.addEventListener('unhandledrejection', function (e) {
            console.error('Unhandled promise rejection:', e.reason);
            alert('Erro de banco de dados. Verifique se o navegador suporta IndexedDB.');
        });
    </script>
</body>

</html>